[{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\App.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\axios\\apiEndpoint.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\axios\\axiosConfig.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Comments\\CommentActionModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Comments\\Comments.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Comments\\CommentsTable.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Comments\\CommentsUtils.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Interactions\\InteractionStats.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Interactions\\Interactions.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Interactions\\InteractionsList.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Interactions\\InteractionsUtils.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Messages\\ChatSidebar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Messages\\ChatWindow.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Messages\\Messages.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'markAsReadMutation'. Either include it or remove the dependency array.","line":38,"column":6,"nodeType":"ArrayExpression","endLine":38,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [markAsReadMutation, selectedChatId]","fix":{"range":[1177,1193],"text":"[markAsReadMutation, selectedChatId]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'messages' logical expression could make the dependencies of useEffect Hook (at line 44) change on every render. To fix this, wrap the initialization of 'messages' in its own useMemo() Hook.","line":41,"column":9,"nodeType":"VariableDeclarator","endLine":41,"endColumn":64}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport {\r\n  useConversations,\r\n  useMessages,\r\n  useSendMessage,\r\n  useMarkAsRead,\r\n} from '@/hooks/useMessageQuery';\r\nimport toast from 'react-hot-toast';\r\n\r\nimport ChatSidebar from './ChatSidebar';\r\nimport ChatWindow from './ChatWindow';\r\n\r\nconst Messages = () => {\r\n  const { user: currentUser } = useSelector(state => state.auth);\r\n\r\n  const [selectedChat, setSelectedChat] = useState(null);\r\n  const [messageInput, setMessageInput] = useState('');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const messagesEndRef = useRef(null);\r\n\r\n  const { data: conversationsData, isLoading: conversationsLoading } =\r\n    useConversations({ page: 1, limit: 20 });\r\n\r\n  const selectedChatId = selectedChat?._id || selectedChat?.id;\r\n  const { data: messagesData, isLoading: messagesLoading } = useMessages({\r\n    conversationId: selectedChatId,\r\n    page: 1,\r\n  });\r\n\r\n  const sendMessageMutation = useSendMessage();\r\n  const markAsReadMutation = useMarkAsRead();\r\n\r\n  useEffect(() => {\r\n    if (selectedChatId) {\r\n      markAsReadMutation.mutate(selectedChatId);\r\n    }\r\n  }, [selectedChatId]);\r\n\r\n  // Scroll to bottom\r\n  const messages = messagesData?.messages || messagesData || [];\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages, selectedChat]);\r\n\r\n  const handleSend = async e => {\r\n    e.preventDefault();\r\n    if (!messageInput.trim() || !selectedChatId) return;\r\n\r\n    try {\r\n      await sendMessageMutation.mutateAsync({\r\n        conversationId: selectedChatId,\r\n        content: messageInput,\r\n        type: 'text',\r\n      });\r\n      setMessageInput('');\r\n    } catch (error) {\r\n      toast.error(error?.response?.data?.message || 'Gửi tin nhắn thất bại');\r\n    }\r\n  };\r\n\r\n  const loading = conversationsLoading || messagesLoading;\r\n  const conversations =\r\n    conversationsData?.conversations || conversationsData || [];\r\n\r\n  return (\r\n    <div className=\"h-[calc(100vh-8rem)] bg-white dark:bg-neutral-900 rounded-2xl border border-neutral-200 dark:border-neutral-800 flex overflow-hidden shadow-sm\">\r\n      <ChatSidebar\r\n        conversations={conversations}\r\n        loading={loading}\r\n        selectedChat={selectedChat}\r\n        setSelectedChat={setSelectedChat}\r\n        currentUser={currentUser}\r\n        searchTerm={searchTerm}\r\n        setSearchTerm={setSearchTerm}\r\n      />\r\n\r\n      <ChatWindow\r\n        selectedChat={selectedChat}\r\n        setSelectedChat={setSelectedChat}\r\n        messages={messages}\r\n        currentUser={currentUser}\r\n        messageInput={messageInput}\r\n        setMessageInput={setMessageInput}\r\n        handleSend={handleSend}\r\n        messagesEndRef={messagesEndRef}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Messages;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Posts\\PostActionModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Posts\\PostDetailModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Posts\\Posts.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Posts\\PostsGrid.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Reports\\ReportDetailModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Reports\\ReportStats.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Reports\\ReportStatusModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Reports\\Reports.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Reports\\ReportsList.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Content\\Reports\\ReportsUtils.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Dashboard\\Dashboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Dashboard\\UserGrowthChart.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Layout\\AdminLayout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Layout\\Sidebar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Shared\\AdminTable.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Shared\\Components.jsx","messages":[],"suppressedMessages":[{"ruleId":"no-unused-vars","severity":2,"message":"'Icon' is defined but never used.","line":357,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":357,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"Icon"},"fix":{"range":[10722,10737],"text":""},"desc":"Remove unused variable 'Icon'."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Shared\\StatCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\System\\Broadcast.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\System\\Notifications.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\System\\SystemHealth.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Users\\AdminActionModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Users\\BannedAccounts.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Users\\StatusBadge.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Users\\UserDetailModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Users\\Users.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Admin\\Users\\UsersTable.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Common\\LoadingSpinner.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Common\\LocationPickerModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Common\\Navigate.jsx","messages":[],"suppressedMessages":[{"ruleId":"no-unused-vars","severity":2,"message":"'Icon' is defined but never used.","line":28,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"Icon"},"fix":{"range":[630,645],"text":""},"desc":"Remove unused variable 'Icon'."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Common\\UserProfilePreview.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\Common\\VideoModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\chat\\ConversationItem.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\chat\\CreateGroupModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\chat\\GroupInfoModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\chat\\MainMessage.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\chat\\MessageDetail.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'conversationsList' logical expression could make the dependencies of useMemo Hook (at line 266) change on every render. Move it inside the useMemo callback. Alternatively, wrap the initialization of 'conversationsList' in its own useMemo() Hook.","line":223,"column":9,"nodeType":"VariableDeclarator","endLine":224,"endColumn":64},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'markAsReadMutation'. Either include it or remove the dependency array.","line":307,"column":6,"nodeType":"ArrayExpression","endLine":307,"endColumn":43,"suggestions":[{"desc":"Update the dependencies array to be: [conversationId, joinRoom, leaveRoom, markAsReadMutation]","fix":{"range":[10153,10190],"text":"[conversationId, joinRoom, leaveRoom, markAsReadMutation]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect, useCallback, useMemo } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { useSelector } from 'react-redux';\r\nimport {\r\n  MessageCircle,\r\n  X,\r\n  ArrowLeft,\r\n  MoreHorizontal,\r\n  Send,\r\n  Image as ImageIcon,\r\n  Smile,\r\n  CheckCheck,\r\n  Loader2,\r\n  Trash2,\r\n  Copy,\r\n  Flag,\r\n  Phone,\r\n  Video,\r\n  Info,\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport {\r\n  useConversations,\r\n  useConversationById,\r\n  useMessages,\r\n  useMarkAsRead,\r\n  useSendMessage,\r\n  useDeleteMessage,\r\n  useUpdateGroup,\r\n  useAddGroupMember,\r\n  useRemoveGroupMember,\r\n  useLeaveGroup,\r\n} from '@/hooks/useMessageQuery';\r\nimport { useSocketContext } from '@/contexts/SocketContext';\r\nimport { lazy, Suspense } from 'react';\r\n\r\n// Lazy load modals\r\nconst ReportModal = lazy(() =>\r\n  import('../report/ReportModal').then(module => ({ default: module.default }))\r\n);\r\nconst GroupInfoModal = lazy(() => import('./GroupInfoModal'));\r\n\r\n// --- Sub-components ---\r\n\r\nconst TypingIndicator = ({ username }) => (\r\n  <div className=\"flex items-center gap-3 px-4 py-3 animate-fade-in transition-all\">\r\n    <div className=\"flex gap-1.5 bg-surface-secondary px-3 py-2 rounded-2xl rounded-bl-none\">\r\n      <div className=\"w-1.5 h-1.5 bg-secondary rounded-full animate-bounce [animation-delay:-0.3s]\" />\r\n      <div className=\"w-1.5 h-1.5 bg-secondary rounded-full animate-bounce [animation-delay:-0.15s]\" />\r\n      <div className=\"w-1.5 h-1.5 bg-secondary rounded-full animate-bounce\" />\r\n    </div>\r\n    <span className=\"text-[10px] font-bold text-text-tertiary uppercase tracking-tight\">\r\n      {username} đang soạn...\r\n    </span>\r\n  </div>\r\n);\r\n\r\nconst MessageBubble = ({\r\n  message,\r\n  isOwn,\r\n  showAvatar,\r\n  avatar,\r\n  onDelete,\r\n  onReport,\r\n}) => {\r\n  const [showMenu, setShowMenu] = useState(false);\r\n\r\n  const handleCopy = () => {\r\n    navigator.clipboard.writeText(message.content);\r\n    toast.success('Đã sao chép tin nhắn');\r\n    setShowMenu(false);\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={`flex w-full mb-1 ${isOwn ? 'justify-end' : 'justify-start'}`}\r\n    >\r\n      <div\r\n        className={`flex max-w-[85%] sm:max-w-[70%] group ${\r\n          isOwn ? 'flex-row-reverse' : 'flex-row'\r\n        } items-end gap-2 relative`}\r\n      >\r\n        {/* Avatar */}\r\n        {!isOwn && (\r\n          <div className=\"w-8 h-8 flex-shrink-0\">\r\n            {showAvatar ? (\r\n              <img\r\n                src={avatar || 'https://via.placeholder.com/150'}\r\n                alt=\"\"\r\n                className=\"w-8 h-8 rounded-full object-cover\"\r\n              />\r\n            ) : (\r\n              <div className=\"w-8\" />\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Bubble */}\r\n        <div className=\"flex flex-col gap-1\">\r\n          <div\r\n            className={`relative px-4 py-2.5 text-sm transition-all duration-200 ${\r\n              isOwn\r\n                ? 'bg-primary text-primary-foreground rounded-2xl rounded-br-none'\r\n                : 'bg-surface-secondary text-content rounded-2xl rounded-bl-none'\r\n            }`}\r\n            onContextMenu={e => {\r\n              e.preventDefault();\r\n              setShowMenu(true);\r\n            }}\r\n          >\r\n            {message.content && (\r\n              <p className=\"whitespace-pre-wrap leading-relaxed break-words font-medium\">\r\n                {message.content}\r\n              </p>\r\n            )}\r\n\r\n            {message.media?.length > 0 && (\r\n              <div className=\"mt-2 space-y-2\">\r\n                {message.media.map((item, i) => (\r\n                  <img\r\n                    key={i}\r\n                    src={item.url}\r\n                    alt=\"\"\r\n                    className=\"rounded-xl max-w-full h-auto object-cover\"\r\n                  />\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            <div\r\n              className={`flex items-center justify-end gap-1 mt-1 ${\r\n                isOwn ? 'opacity-60' : 'text-text-tertiary'\r\n              } text-[10px] font-medium`}\r\n            >\r\n              <span>\r\n                {new Date(message.createdAt).toLocaleTimeString([], {\r\n                  hour: '2-digit',\r\n                  minute: '2-digit',\r\n                })}\r\n              </span>\r\n              {isOwn && (\r\n                <div className=\"ml-0.5\">\r\n                  {message.status === 'read' || message.isRead ? (\r\n                    <CheckCheck size={12} />\r\n                  ) : (\r\n                    <CheckCheck size={12} className=\"opacity-40\" />\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Action Button */}\r\n        <button\r\n          onClick={() => setShowMenu(!showMenu)}\r\n          className={`p-1.5 rounded-full hover:bg-surface-hover opacity-0 group-hover:opacity-100 transition-all ${\r\n            isOwn ? 'mr-1' : 'ml-1'\r\n          }`}\r\n        >\r\n          <MoreHorizontal size={14} className=\"text-text-tertiary\" />\r\n        </button>\r\n\r\n        {/* Floating Menu */}\r\n        {showMenu && (\r\n          <>\r\n            <div\r\n              className=\"fixed inset-0 z-[60]\"\r\n              onClick={() => setShowMenu(false)}\r\n            />\r\n            <div\r\n              className={`absolute ${\r\n                isOwn ? 'right-full mr-2' : 'left-full ml-2'\r\n              } bottom-2 z-[70] bg-surface rounded-xl py-1.5 min-w-[150px] animate-scale-in`}\r\n            >\r\n              <button\r\n                onClick={handleCopy}\r\n                className=\"w-full px-4 py-2 text-left text-xs font-bold flex items-center gap-2.5 hover:bg-surface-hover text-content transition-colors\"\r\n              >\r\n                <Copy size={16} /> Sao chép\r\n              </button>\r\n              {isOwn ? (\r\n                <button\r\n                  onClick={() => {\r\n                    onDelete(message._id || message.id);\r\n                    setShowMenu(false);\r\n                  }}\r\n                  className=\"w-full px-4 py-2 text-left text-xs font-bold flex items-center gap-2.5 hover:bg-error/5 text-error transition-colors\"\r\n                >\r\n                  <Trash2 size={16} /> Gỡ bỏ\r\n                </button>\r\n              ) : (\r\n                <button\r\n                  onClick={() => {\r\n                    onReport(message._id || message.id);\r\n                    setShowMenu(false);\r\n                  }}\r\n                  className=\"w-full px-4 py-2 text-left text-xs font-bold flex items-center gap-2.5 hover:bg-warning/5 text-warning transition-colors\"\r\n                >\r\n                  <Flag size={16} /> Báo cáo\r\n                </button>\r\n              )}\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// --- Main Component ---\r\n\r\nconst MessageDetail = () => {\r\n  const { conversationId } = useParams();\r\n  const navigate = useNavigate();\r\n  const { socket, isConnected, joinRoom, leaveRoom, isUserOnline } =\r\n    useSocketContext() || {};\r\n\r\n  const { user: currentUser } = useSelector(state => state.auth);\r\n\r\n  // Queries\r\n  const { data: conversationsData } = useConversations();\r\n  const conversationsList =\r\n    conversationsData?.conversations || conversationsData || [];\r\n\r\n  const { data: conversationData, isLoading: conversationLoading } =\r\n    useConversationById(conversationId);\r\n\r\n  const { data: messagesData, isLoading: messagesLoading } = useMessages({\r\n    conversationId,\r\n    page: 1,\r\n    limit: 50,\r\n  });\r\n  const messagesList = messagesData?.messages || messagesData || [];\r\n\r\n  // Mutations\r\n  const markAsReadMutation = useMarkAsRead();\r\n  const sendMessageMutation = useSendMessage();\r\n  const deleteMessageMutation = useDeleteMessage();\r\n  const updateGroupMutation = useUpdateGroup();\r\n  const addMemberMutation = useAddGroupMember();\r\n  const removeMemberMutation = useRemoveGroupMember();\r\n  const leaveGroupMutation = useLeaveGroup();\r\n\r\n  const [messageText, setMessageText] = useState('');\r\n  const [selectedImages, setSelectedImages] = useState([]);\r\n  const [showGroupInfo, setShowGroupInfo] = useState(false);\r\n  const [reportMessageId, setReportMessageId] = useState(null);\r\n  const [isOtherUserTyping, setIsOtherUserTyping] = useState(false);\r\n  const [isUpdatingGroup, setIsUpdatingGroup] = useState(false);\r\n\r\n  const messagesEndRef = useRef(null);\r\n  const fileInputRef = useRef(null);\r\n  const typingTimeoutRef = useRef(null);\r\n\r\n  // Derive conversation\r\n  const conversation = useMemo(() => {\r\n    if (conversationData) return conversationData;\r\n    return conversationsList.find(\r\n      c =>\r\n        c._id === conversationId ||\r\n        c.conversationId === conversationId ||\r\n        c.id === conversationId ||\r\n        c.directId === conversationId\r\n    );\r\n  }, [conversationData, conversationsList, conversationId]);\r\n\r\n  const messages = messagesList;\r\n\r\n  const otherUser = useMemo(() => {\r\n    if (!conversation || conversation.isGroup) return null;\r\n\r\n    // Explicitly find the person who is NOT the current user\r\n    const other =\r\n      conversation.otherUser ||\r\n      conversation.participant ||\r\n      conversation.members?.find(\r\n        m => (m._id || m.id)?.toString() !== currentUser?._id?.toString()\r\n      );\r\n\r\n    return other;\r\n  }, [conversation, currentUser]);\r\n\r\n  const chatName = conversation?.isGroup\r\n    ? conversation.name || 'Nhóm chat'\r\n    : otherUser?.name ||\r\n      otherUser?.fullName ||\r\n      otherUser?.username ||\r\n      'Đang tải...';\r\n  const chatAvatar = conversation?.isGroup\r\n    ? `https://ui-avatars.com/api/?name=${encodeURIComponent(\r\n        conversation.name || 'G'\r\n      )}&background=random&size=100`\r\n    : otherUser?.avatar || 'https://via.placeholder.com/150';\r\n\r\n  const isOnline = otherUser?._id ? isUserOnline?.(otherUser._id) : false;\r\n\r\n  // Lifecycle - Join room and fetch messages (only when conversationId changes)\r\n  useEffect(() => {\r\n    if (conversationId) {\r\n      if (joinRoom) joinRoom(conversationId);\r\n      markAsReadMutation.mutate(conversationId);\r\n    }\r\n    return () => {\r\n      if (conversationId && leaveRoom) leaveRoom(conversationId);\r\n    };\r\n  }, [conversationId, joinRoom, leaveRoom]);\r\n\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages, isOtherUserTyping]);\r\n\r\n  // Socket listeners\r\n  useEffect(() => {\r\n    if (!socket || !isConnected) return;\r\n\r\n    const isCurrentConversation = id => {\r\n      return (\r\n        id === conversationId ||\r\n        (conversation &&\r\n          (id === conversation?._id || id === conversation?.directId))\r\n      );\r\n    };\r\n\r\n    const handleTyping = data => {\r\n      if (\r\n        isCurrentConversation(data.conversationId) &&\r\n        data.senderId !== currentUser?._id\r\n      ) {\r\n        setIsOtherUserTyping(true);\r\n      }\r\n    };\r\n\r\n    const handleStopTyping = data => {\r\n      if (\r\n        isCurrentConversation(data.conversationId) &&\r\n        data.senderId !== currentUser?._id\r\n      ) {\r\n        setIsOtherUserTyping(false);\r\n      }\r\n    };\r\n\r\n    socket.on('user_typing', handleTyping);\r\n    socket.on('user_stop_typing', handleStopTyping);\r\n    return () => {\r\n      socket.off('user_typing', handleTyping);\r\n      socket.off('user_stop_typing', handleStopTyping);\r\n    };\r\n  }, [socket, isConnected, conversationId, currentUser?._id, conversation]);\r\n\r\n  // Handlers\r\n  const emitTyping = useCallback(\r\n    isTyping => {\r\n      if (!socket || !isConnected || !conversationId) return;\r\n      socket.emit(isTyping ? 'user_typing' : 'user_stop_typing', {\r\n        senderId: currentUser?._id,\r\n        conversationId,\r\n      });\r\n    },\r\n    [socket, isConnected, conversationId, currentUser?._id]\r\n  );\r\n\r\n  const handleInputChange = e => {\r\n    setMessageText(e.target.value);\r\n    emitTyping(true);\r\n    if (typingTimeoutRef.current) clearTimeout(typingTimeoutRef.current);\r\n    typingTimeoutRef.current = setTimeout(() => emitTyping(false), 2000);\r\n  };\r\n\r\n  const handleSend = async () => {\r\n    if (!messageText.trim() && selectedImages.length === 0) return;\r\n    emitTyping(false);\r\n    try {\r\n      await sendMessageMutation.mutateAsync({\r\n        conversationId,\r\n        content: messageText.trim(),\r\n        type: selectedImages.length > 0 ? 'image' : 'text',\r\n        attachments: selectedImages.length > 0 ? selectedImages : undefined,\r\n      });\r\n      setMessageText('');\r\n      setSelectedImages([]);\r\n    } catch (error) {\r\n      toast.error(error?.response?.data?.message || 'Gửi tin nhắn thất bại');\r\n    }\r\n  };\r\n\r\n  const handleDelete = async mid => {\r\n    try {\r\n      await deleteMessageMutation.mutateAsync({\r\n        conversationId,\r\n        messageId: mid,\r\n      });\r\n      toast.success('Đã xóa tin nhắn');\r\n    } catch (err) {\r\n      toast.error(err?.response?.data?.message || 'Không thể xóa tin nhắn');\r\n    }\r\n  };\r\n\r\n  const handleGroupRename = async name => {\r\n    try {\r\n      setIsUpdatingGroup(true);\r\n      await updateGroupMutation.mutateAsync({\r\n        groupId: conversationId,\r\n        data: { name },\r\n      });\r\n      toast.success('Đã đổi tên nhóm');\r\n    } catch (err) {\r\n      toast.error(err?.response?.data?.message || 'Cập nhật thất bại');\r\n    } finally {\r\n      setIsUpdatingGroup(false);\r\n    }\r\n  };\r\n\r\n  const handleAddMember = async uid => {\r\n    try {\r\n      await addMemberMutation.mutateAsync({\r\n        groupId: conversationId,\r\n        memberIds: [uid],\r\n      });\r\n      toast.success('Đã thêm thành viên');\r\n    } catch (err) {\r\n      toast.error(err?.response?.data?.message || 'Thêm thành viên thất bại');\r\n    }\r\n  };\r\n\r\n  const handleRemoveMember = async uid => {\r\n    try {\r\n      await removeMemberMutation.mutateAsync({\r\n        groupId: conversationId,\r\n        userId: uid,\r\n      });\r\n      toast.success('Đã mời thành viên rời nhóm');\r\n    } catch (err) {\r\n      toast.error(err?.response?.data?.message || 'Thực hiện thất bại');\r\n    }\r\n  };\r\n\r\n  const handleLeave = async () => {\r\n    if (window.confirm('Bạn có chắc muốn rời nhóm này?')) {\r\n      try {\r\n        await leaveGroupMutation.mutateAsync(conversationId);\r\n        navigate('/messages');\r\n      } catch (err) {\r\n        toast.error(err?.response?.data?.message || 'Rời nhóm thất bại');\r\n      }\r\n    }\r\n  };\r\n\r\n  if (!conversation && conversationLoading) {\r\n    return (\r\n      <div className=\"flex-1 flex flex-col items-center justify-center space-y-4 bg-white dark:bg-neutral-950\">\r\n        <Loader2 className=\"w-10 h-10 animate-spin text-blue-500\" />\r\n        <p className=\"text-sm font-bold text-neutral-400 uppercase tracking-widest\">\r\n          Đang tải cuộc trò chuyện...\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const isLoading = messagesLoading || conversationLoading;\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col bg-background animate-fade-in\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between p-4 px-6 bg-surface/80 backdrop-blur-xl z-20 shadow-sm\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <button\r\n            onClick={() => navigate('/messages')}\r\n            className=\"md:hidden p-2 -ml-2 rounded-full hover:bg-surface-hover transition-colors\"\r\n          >\r\n            <ArrowLeft size={20} className=\"text-secondary\" />\r\n          </button>\r\n\r\n          <div\r\n            className=\"relative group cursor-pointer\"\r\n            onClick={() => conversation?.isGroup && setShowGroupInfo(true)}\r\n          >\r\n            <img\r\n              src={chatAvatar}\r\n              alt=\"\"\r\n              className=\"w-11 h-11 rounded-full object-cover group-hover:scale-105 transition-transform ring-2 ring-transparent group-hover:ring-primary/20\"\r\n            />\r\n            {!conversation?.isGroup && isOnline && (\r\n              <div className=\"absolute bottom-0 right-0 w-3.5 h-3.5 bg-success rounded-full\" />\r\n            )}\r\n          </div>\r\n\r\n          <div\r\n            className=\"min-w-0 flex flex-col cursor-pointer\"\r\n            onClick={() => conversation?.isGroup && setShowGroupInfo(true)}\r\n          >\r\n            <h2 className=\"font-bold text-content truncate text-base tracking-tight leading-tight\">\r\n              {chatName}\r\n            </h2>\r\n            <div className=\"flex items-center gap-1.5\">\r\n              {conversation?.isGroup ? (\r\n                <span className=\"text-[10px] font-black text-text-tertiary uppercase tracking-tight\">\r\n                  {conversation.members?.length || 0} thành viên\r\n                </span>\r\n              ) : (\r\n                <span\r\n                  className={`text-[10px] font-black uppercase tracking-tight ${\r\n                    isOnline ? 'text-success' : 'text-text-tertiary'\r\n                  }`}\r\n                >\r\n                  {isOnline ? 'Đang hoạt động' : 'Ngoại tuyến'}\r\n                </span>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-1\">\r\n          <button className=\"yb-btn-ghost p-2.5 rounded-full transition-all text-secondary hover:text-primary\">\r\n            <Phone size={20} />\r\n          </button>\r\n          <button className=\"yb-btn-ghost p-2.5 rounded-full transition-all text-secondary hover:text-primary\">\r\n            <Video size={20} />\r\n          </button>\r\n          <button\r\n            onClick={() => setShowGroupInfo(true)}\r\n            className=\"yb-btn-ghost p-2.5 rounded-full transition-all text-secondary hover:text-primary\"\r\n          >\r\n            <Info size={22} />\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Messages Area */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 px-6 space-y-4 scroll-smooth custom-scrollbar relative bg-surface-secondary/30\">\r\n        {isLoading && messages.length === 0 ? (\r\n          <div className=\"absolute inset-0 flex flex-col items-center justify-center space-y-3 bg-surface/50 backdrop-blur-[2px] z-10\">\r\n            <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n            <p className=\"text-[10px] font-bold text-text-tertiary uppercase tracking-widest\">\r\n              Đang tải tin nhắn...\r\n            </p>\r\n          </div>\r\n        ) : null}\r\n\r\n        {messages.length === 0 && !isLoading ? (\r\n          <div className=\"flex flex-col items-center justify-center h-full space-y-6\">\r\n            <div className=\"w-20 h-20 rounded-full bg-surface-hover flex items-center justify-center\">\r\n              <MessageCircle size={32} className=\"text-text-tertiary\" />\r\n            </div>\r\n            <div className=\"text-center\">\r\n              <p className=\"font-bold text-content\">Chưa có tin nhắn nào</p>\r\n              <p className=\"text-xs text-text-tertiary font-medium\">\r\n                Hãy gửi lời chào đến {chatName}!\r\n              </p>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex flex-col gap-1.5 min-h-full justify-end\">\r\n            {messages.map((msg, idx) => {\r\n              const isOwn =\r\n                msg.isMine ??\r\n                (msg.sender?._id === currentUser?._id ||\r\n                  msg.sender === currentUser?._id);\r\n              const prevMsg = messages[idx - 1];\r\n              const showAvatar =\r\n                !isOwn &&\r\n                (!prevMsg ||\r\n                  (prevMsg.sender?._id || prevMsg.sender) !==\r\n                    (msg.sender?._id || msg.sender));\r\n\r\n              const sender = conversation?.isGroup\r\n                ? conversation.members?.find(\r\n                    m => m._id === (msg.sender?._id || msg.sender)\r\n                  )\r\n                : otherUser;\r\n\r\n              return (\r\n                <div key={msg._id || msg.id} className=\"w-full\">\r\n                  {conversation?.isGroup && !isOwn && showAvatar && (\r\n                    <span className=\"text-[10px] font-bold text-text-tertiary ml-10 mb-1 block uppercase tracking-tight\">\r\n                      {sender?.name || 'Thành viên'}\r\n                    </span>\r\n                  )}\r\n                  <MessageBubble\r\n                    message={msg}\r\n                    isOwn={isOwn}\r\n                    showAvatar={showAvatar}\r\n                    avatar={sender?.avatar}\r\n                    onDelete={handleDelete}\r\n                    onReport={id => setReportMessageId(id)}\r\n                  />\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n        {isOtherUserTyping && (\r\n          <TypingIndicator\r\n            username={conversation?.isGroup ? 'Ai đó' : chatName}\r\n          />\r\n        )}\r\n        <div ref={messagesEndRef} className=\"h-2\" />\r\n      </div>\r\n\r\n      {/* Input Area */}\r\n      <div className=\"p-4 px-6 bg-surface\">\r\n        {selectedImages.length > 0 && (\r\n          <div className=\"flex gap-3 overflow-x-auto pb-4 hide-scrollbar\">\r\n            {selectedImages.map((file, i) => (\r\n              <div\r\n                key={i}\r\n                className=\"relative group flex-shrink-0 animate-scale-in\"\r\n              >\r\n                <img\r\n                  src={URL.createObjectURL(file)}\r\n                  alt=\"\"\r\n                  className=\"w-20 h-20 rounded-xl object-cover\"\r\n                />\r\n                <button\r\n                  onClick={() =>\r\n                    setSelectedImages(prev =>\r\n                      prev.filter((_, idx) => idx !== i)\r\n                    )\r\n                  }\r\n                  className=\"absolute -top-2 -right-2 bg-primary text-primary-foreground rounded-full p-1 hover:bg-error transition-colors\"\r\n                >\r\n                  <X size={12} />\r\n                </button>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"flex items-center gap-3\">\r\n          <input\r\n            ref={fileInputRef}\r\n            type=\"file\"\r\n            multiple\r\n            accept=\"image/*\"\r\n            className=\"hidden\"\r\n            onChange={e =>\r\n              setSelectedImages(prev => [\r\n                ...prev,\r\n                ...Array.from(e.target.files),\r\n              ])\r\n            }\r\n          />\r\n          <div className=\"flex items-center bg-surface-secondary rounded-2xl flex-1 px-1 focus-within:bg-white transition-all duration-300\">\r\n            <button\r\n              onClick={() => fileInputRef.current?.click()}\r\n              className=\"yb-btn-ghost p-3 text-secondary hover:text-primary rounded-full transition-all\"\r\n            >\r\n              <ImageIcon size={20} />\r\n            </button>\r\n            <button className=\"yb-btn-ghost p-3 text-secondary hover:text-primary rounded-full transition-all\">\r\n              <Smile size={20} />\r\n            </button>\r\n            <input\r\n              type=\"text\"\r\n              value={messageText}\r\n              onChange={handleInputChange}\r\n              onKeyDown={e => e.key === 'Enter' && !e.shiftKey && handleSend()}\r\n              placeholder=\"Nhập tin nhắn...\"\r\n              className=\"flex-1 bg-transparent border-none py-4 px-2 text-sm focus:outline-none text-content placeholder:text-text-tertiary font-medium\"\r\n            />\r\n          </div>\r\n          <button\r\n            onClick={handleSend}\r\n            disabled={\r\n              (!messageText.trim() && selectedImages.length === 0) ||\r\n              sendMessageMutation.isPending\r\n            }\r\n            className={`yb-btn p-4 rounded-full transition-all duration-300 ${\r\n              (messageText.trim() || selectedImages.length > 0) &&\r\n              !sendMessageMutation.isPending\r\n                ? 'yb-btn-primary hover:scale-105 active:scale-95'\r\n                : 'bg-surface-secondary text-text-tertiary cursor-not-allowed'\r\n            }`}\r\n          >\r\n            {sendMessageMutation.isPending ? (\r\n              <Loader2 size={24} className=\"animate-spin\" />\r\n            ) : (\r\n              <Send\r\n                size={24}\r\n                className={\r\n                  messageText.trim() ? 'translate-x-0.5 -translate-y-0.5' : ''\r\n                }\r\n              />\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modals */}\r\n      <Suspense fallback={null}>\r\n        {showGroupInfo && (\r\n          <GroupInfoModal\r\n            isOpen={showGroupInfo}\r\n            onClose={() => setShowGroupInfo(false)}\r\n            conversation={conversation}\r\n            currentUserId={currentUser?._id}\r\n            onRename={handleRename => handleGroupRename(handleRename)}\r\n            onAddMember={uid => handleAddMember(uid)}\r\n            onRemoveMember={uid => handleRemoveMember(uid)}\r\n            onLeaveGroup={handleLeave}\r\n            isUpdating={isUpdatingGroup}\r\n          />\r\n        )}\r\n        {reportMessageId && (\r\n          <ReportModal\r\n            isOpen={!!reportMessageId}\r\n            onClose={() => setReportMessageId(null)}\r\n            targetId={reportMessageId}\r\n            targetType=\"message\"\r\n          />\r\n        )}\r\n      </Suspense>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MessageDetail;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\feed\\Comment\\CommentItem.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\feed\\Comment\\CommentModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\feed\\Contents\\Contents.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\feed\\Posts\\CreatePost.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\feed\\Posts\\InvalidPostFallback.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\feed\\Posts\\ModelPost.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\feed\\Posts\\Post.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\feed\\Posts\\PostLists.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\feed\\Posts\\PostOption.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\feed\\Posts\\ShowImagePost.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\feed\\Posts\\ShowVideoPost.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\feed\\TrendingTopics\\TrendingCircles.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\feed\\TrendingTopics\\TrendingTopics.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\notifications\\NotificationBell.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\notifications\\NotificationPanel.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\report\\ReportModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\search\\SearchUser.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\settings\\AccountSettings.jsx","messages":[],"suppressedMessages":[{"ruleId":"no-unused-vars","severity":2,"message":"'Icon' is defined but never used.","line":91,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":91,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"Icon"},"fix":{"range":[2583,2594],"text":""},"desc":"Remove unused variable 'Icon'."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\settings\\BlockedMutedSettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\settings\\FollowRequestsSettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\settings\\NotificationSettings.jsx","messages":[],"suppressedMessages":[{"ruleId":"no-unused-vars","severity":2,"message":"'Icon' is defined but never used.","line":89,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":89,"endColumn":17,"suggestions":[{"messageId":"removeVar","data":{"varName":"Icon"},"fix":{"range":[2603,2614],"text":""},"desc":"Remove unused variable 'Icon'."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\settings\\PrivacySettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\settings\\ProfileSettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\settings\\SecuritySettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\settings\\SettingsLayout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\settings\\SideBarSettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\user\\FollowList\\FollowList.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\user\\Profiles\\FollowingUser.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\user\\Profiles\\Friends.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\user\\Profiles\\HomeProfile.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\user\\Profiles\\Profile.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\user\\Profiles\\ProfileLayout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\user\\Profiles\\SavePosts.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\user\\Profiles\\SideBarProfile.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\user\\Profiles\\SuggestFriends.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\components\\features\\user\\TopUser\\TopUser.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\constants\\broadcast.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\constants\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\constants\\privacy.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\constants\\report.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\constants\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\constants\\socket.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\contexts\\SocketContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":7,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":7,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport useSocket from '@/hooks/useSocket';\r\n\r\nconst SocketContext = createContext(null);\r\n\r\nexport const useSocketContext = () => useContext(SocketContext);\r\n\r\nexport const SocketProvider = ({ children }) => {\r\n  const { user } = useSelector(state => state.auth);\r\n  const userId = user?._id || user?.user?._id;\r\n\r\n  const socketData = useSocket(userId);\r\n\r\n  return (\r\n    <SocketContext.Provider value={socketData}>\r\n      {children}\r\n    </SocketContext.Provider>\r\n  );\r\n};\r\n\r\nexport default SocketProvider;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\hooks\\useAdminQuery.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\hooks\\useCommentQuery.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\hooks\\useComments.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\hooks\\useDebounce.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\hooks\\useFeedQuery.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\hooks\\useMessageQuery.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\hooks\\useNotificationQuery.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\hooks\\usePostsQuery.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\hooks\\useReportQuery.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\hooks\\useSearchQuery.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\hooks\\useSocket.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'activeRooms.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'activeRooms.current' to a variable inside the effect, and use that variable in the cleanup function.","line":86,"column":21,"nodeType":"Identifier","endLine":86,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useRef, useState, useCallback, useMemo } from 'react';\r\nimport { useQueryClient } from '@tanstack/react-query';\r\nimport io from 'socket.io-client';\r\nimport { toast } from 'react-hot-toast';\r\nimport { SOCKET_URL, MAX_RECONNECT_ATTEMPTS } from '@/constants/socket';\r\n\r\n/**\r\n * Hook to manage Socket.IO connection\r\n * @param {string} userId - Current user ID\r\n * @returns {Object} Socket instance and utility functions\r\n * @returns {Object|null} returns.socket - Socket.IO instance\r\n * @returns {Function} returns.joinRoom - Join room function\r\n * @returns {Function} returns.leaveRoom - Leave room function\r\n * @returns {Function} returns.sendMessage - Send message function\r\n * @returns {Function} returns.emitEvent - Emit custom event function\r\n * @returns {Function} returns.joinPostRoom - Join post room function\r\n * @returns {Function} returns.emitLikeAction - Emit like action function\r\n * @returns {boolean} returns.isConnected - Connection status\r\n * @returns {Object} returns.onlineUsers - Online users map\r\n * @returns {Function} returns.isUserOnline - Check user online function\r\n */\r\nconst useSocket = userId => {\r\n  const socketRef = useRef(null);\r\n  const queryClient = useQueryClient();\r\n  const reconnectAttempts = useRef(0);\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const activeRooms = useRef(new Set());\r\n  const [onlineUsers, setOnlineUsers] = useState({});\r\n\r\n  useEffect(() => {\r\n    if (!userId) return;\r\n\r\n    const socket = io(SOCKET_URL, {\r\n      withCredentials: true,\r\n      reconnection: true,\r\n      reconnectionDelay: 1000,\r\n      reconnectionDelayMax: 5000,\r\n      reconnectionAttempts: MAX_RECONNECT_ATTEMPTS,\r\n      path: '/socket.io/',\r\n    });\r\n\r\n    socketRef.current = socket;\r\n\r\n    socket.on('connect', () => {\r\n      reconnectAttempts.current = 0;\r\n      setIsConnected(true);\r\n\r\n      socket.emit('register_user', { userId });\r\n      socket.emit('join_room', userId);\r\n      activeRooms.current.add(userId);\r\n      activeRooms.current.forEach(room => {\r\n        if (room !== userId) socket.emit('join_room', room);\r\n      });\r\n\r\n      socket.emit('get_online_users');\r\n      queryClient.invalidateQueries(['messages', 'unreadCount']);\r\n      queryClient.invalidateQueries(['notifications', 'unreadCount']);\r\n    });\r\n\r\n    socket.on('disconnect', reason => {\r\n      setIsConnected(false);\r\n      if (reason === 'io server disconnect') {\r\n        setTimeout(() => socket.connect(), 1000);\r\n      }\r\n    });\r\n\r\n    socket.on('connect_error', () => {\r\n      setIsConnected(false);\r\n      reconnectAttempts.current++;\r\n      if (reconnectAttempts.current >= MAX_RECONNECT_ATTEMPTS) {\r\n        toast.error('Unable to connect to chat server');\r\n      }\r\n    });\r\n\r\n    registerMessageHandlers(socket, userId, queryClient);\r\n    registerNotificationHandlers(socket, queryClient);\r\n    registerLikeHandlers(socket, userId, queryClient);\r\n    registerCommentHandlers(socket, userId, queryClient);\r\n    registerUserStatusHandlers(socket, setOnlineUsers);\r\n\r\n    return () => {\r\n      if (socket) {\r\n        socket.disconnect();\r\n        socketRef.current = null;\r\n        setIsConnected(false);\r\n        activeRooms.current.clear();\r\n      }\r\n    };\r\n  }, [userId, queryClient]);\r\n\r\n  /**\r\n   * Join a room\r\n   * @param {string} roomId - Room ID\r\n   */\r\n  const joinRoom = useCallback(roomId => {\r\n    if (!roomId) return;\r\n    if (activeRooms.current.has(roomId)) return;\r\n\r\n    if (socketRef.current?.connected) {\r\n      socketRef.current.emit('join_room', roomId);\r\n    }\r\n    activeRooms.current.add(roomId);\r\n  }, []);\r\n\r\n  /**\r\n   * Leave a room\r\n   * @param {string} roomId - Room ID\r\n   */\r\n  const leaveRoom = useCallback(roomId => {\r\n    if (!roomId) return;\r\n    if (!activeRooms.current.has(roomId)) return;\r\n\r\n    activeRooms.current.delete(roomId);\r\n    if (socketRef.current?.connected) {\r\n      socketRef.current.emit('leave_room', roomId);\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Send message via socket\r\n   * @param {Object} data - Message data\r\n   * @returns {boolean} Send result\r\n   */\r\n  const sendMessage = useCallback(data => {\r\n    if (!socketRef.current?.connected) return false;\r\n    socketRef.current.emit('send_message', data);\r\n    return true;\r\n  }, []);\r\n\r\n  /**\r\n   * Emit custom event\r\n   * @param {string} event - Event name\r\n   * @param {*} data - Event data\r\n   * @returns {boolean} Emit result\r\n   */\r\n  const emitEvent = useCallback((event, data) => {\r\n    if (!socketRef.current?.connected) return false;\r\n    socketRef.current.emit(event, data);\r\n    return true;\r\n  }, []);\r\n\r\n  /**\r\n   * Join post room to receive updates\r\n   * @param {string} postId - Post ID\r\n   */\r\n  const joinPostRoom = useCallback(\r\n    postId => {\r\n      if (!postId) return;\r\n      joinRoom(`post:${postId}`);\r\n      emitEvent('post:like:listen', postId);\r\n    },\r\n    [joinRoom, emitEvent]\r\n  );\r\n\r\n  /**\r\n   * Emit like action for post\r\n   * @param {string} postId - Post ID\r\n   * @param {string} action - Action ('like' | 'unlike')\r\n   */\r\n  const emitLikeAction = useCallback(\r\n    (postId, action) => {\r\n      emitEvent('post:like', { postId, userId, action });\r\n    },\r\n    [emitEvent, userId]\r\n  );\r\n\r\n  /**\r\n   * Check if user is online\r\n   * @param {string} uid - User ID to check\r\n   * @returns {boolean} Online status\r\n   */\r\n  const isUserOnline = useCallback(\r\n    uid => {\r\n      if (!uid) return false;\r\n      return !!onlineUsers[uid.toString()];\r\n    },\r\n    [onlineUsers]\r\n  );\r\n\r\n  return useMemo(\r\n    () => ({\r\n      socket: socketRef.current,\r\n      joinRoom,\r\n      leaveRoom,\r\n      sendMessage,\r\n      emitEvent,\r\n      joinPostRoom,\r\n      emitLikeAction,\r\n      isConnected,\r\n      onlineUsers,\r\n      isUserOnline,\r\n    }),\r\n    [\r\n      joinRoom,\r\n      leaveRoom,\r\n      sendMessage,\r\n      emitEvent,\r\n      joinPostRoom,\r\n      emitLikeAction,\r\n      isConnected,\r\n      onlineUsers,\r\n      isUserOnline,\r\n    ]\r\n  );\r\n};\r\n\r\n/**\r\n * Register message handlers\r\n * @param {Object} socket - Socket instance\r\n * @param {string} userId - Current user ID\r\n * @param {Object} queryClient - React Query client\r\n */\r\nconst registerMessageHandlers = (socket, userId, queryClient) => {\r\n  socket.on('new_message', message => {\r\n    if (!message?._id) return;\r\n\r\n    const senderId = message.sender?._id || message.sender;\r\n    const isMine =\r\n      senderId && userId && senderId.toString() === userId.toString();\r\n\r\n    queryClient.invalidateQueries(['messages', 'list', message.conversationId]);\r\n    queryClient.invalidateQueries([\r\n      'messages',\r\n      'infinite',\r\n      message.conversationId,\r\n    ]);\r\n    queryClient.invalidateQueries(['messages', 'conversations']);\r\n    queryClient.invalidateQueries(['messages', 'unreadCount']);\r\n\r\n    if (!isMine) {\r\n      const senderName =\r\n        message.sender?.firstName || message.sender?.name || 'User';\r\n      toast.success(`New message from ${senderName}`);\r\n    }\r\n  });\r\n\r\n  socket.on('message_read', data => {\r\n    if (data?.messageId) {\r\n      queryClient.invalidateQueries(['messages']);\r\n    }\r\n  });\r\n\r\n  socket.on('user_typing', () => {});\r\n  socket.on('user_stop_typing', () => {});\r\n};\r\n\r\n/**\r\n * Register notification handlers\r\n * @param {Object} socket - Socket instance\r\n * @param {Object} queryClient - React Query client\r\n */\r\nconst registerNotificationHandlers = (socket, queryClient) => {\r\n  const handleNotification = notification => {\r\n    if (!notification?._id) {\r\n      queryClient.invalidateQueries(['notifications', 'unreadCount']);\r\n      return;\r\n    }\r\n\r\n    queryClient.invalidateQueries(['notifications']);\r\n    queryClient.invalidateQueries(['notifications', 'unreadCount']);\r\n\r\n    let msg = notification.content || 'You have a new notification';\r\n    if (notification.type === 'like' && notification.post?.caption) {\r\n      msg += ` - \"${notification.post.caption.substring(0, 20)}...\"`;\r\n    }\r\n    toast.success(msg, { icon: '🔔' });\r\n  };\r\n\r\n  socket.on('notification:new', handleNotification);\r\n  socket.on('new_notification', handleNotification);\r\n};\r\n\r\n/**\r\n * Register like handlers\r\n * @param {Object} socket - Socket instance\r\n * @param {string} currentUserId - Current user ID\r\n * @param {Object} queryClient - React Query client\r\n */\r\nconst registerLikeHandlers = (socket, currentUserId, queryClient) => {\r\n  socket.on('post:like:update', ({ postId, userId }) => {\r\n    if (userId === currentUserId) return;\r\n\r\n    queryClient.invalidateQueries(['feed']);\r\n    queryClient.invalidateQueries(['posts']);\r\n    queryClient.invalidateQueries(['post', postId]);\r\n    queryClient.invalidateQueries(['likeStatus', postId]);\r\n  });\r\n};\r\n\r\n/**\r\n * Register user status handlers\r\n * @param {Object} socket - Socket instance\r\n * @param {Function} setOnlineUsers - Online users state setter\r\n */\r\nconst registerUserStatusHandlers = (socket, setOnlineUsers) => {\r\n  socket.on('get_users_online', users => {\r\n    const map = {};\r\n    if (Array.isArray(users)) users.forEach(id => (map[id] = true));\r\n    else Object.assign(map, users || {});\r\n    setOnlineUsers(map);\r\n  });\r\n\r\n  socket.on('user_status_change', ({ userId, status }) => {\r\n    setOnlineUsers(prev => ({ ...prev, [userId]: status === 'online' }));\r\n  });\r\n};\r\n\r\n/**\r\n * Register comment handlers\r\n * @param {Object} socket - Socket instance\r\n * @param {string} currentUserId - Current user ID\r\n * @param {Object} queryClient - React Query client\r\n */\r\nconst registerCommentHandlers = (socket, currentUserId, queryClient) => {\r\n  socket.on('new_comment', data => {\r\n    const { postId, userId } = data;\r\n    if (userId === currentUserId) return;\r\n\r\n    queryClient.invalidateQueries(['post', postId]);\r\n    queryClient.invalidateQueries(['comments', postId]);\r\n    queryClient.invalidateQueries(['posts']);\r\n    queryClient.invalidateQueries(['feed']);\r\n  });\r\n\r\n  socket.on('delete_comment', data => {\r\n    const { postId, userId } = data;\r\n    if (userId === currentUserId) return;\r\n\r\n    queryClient.invalidateQueries(['post', postId]);\r\n    queryClient.invalidateQueries(['comments', postId]);\r\n    queryClient.invalidateQueries(['posts']);\r\n    queryClient.invalidateQueries(['feed']);\r\n  });\r\n};\r\n\r\nexport default useSocket;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\hooks\\useUserQuery.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\main.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\AdminPage\\AdminPage.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\AuthPage\\AdminRoute.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\AuthPage\\AuthLayout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\AuthPage\\EnterCode.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\AuthPage\\ForgotPassword.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\AuthPage\\Login.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'clearError' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"clearError"},"fix":{"range":[335,389],"text":""},"desc":"Remove unused variable 'clearError'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useCallback, useEffect } from 'react';\r\nimport { Link, Navigate, useNavigate } from 'react-router-dom';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { Sparkles, Mail, Lock, Eye, EyeOff, AlertCircle } from 'lucide-react';\r\nimport { login, googleAuth } from '@/redux/actions/authActions';\r\nimport { clearError } from '@/redux/slices/AuthSlice';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst Login = () => {\r\n  const dispatch = useDispatch();\r\n  const navigate = useNavigate();\r\n  const googleButtonRef = useRef(null);\r\n  const googleInitialized = useRef(false);\r\n  const { loading, error, isAuthenticated, user } = useSelector(\r\n    state => state.auth\r\n  );\r\n\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    email: '',\r\n    password: '',\r\n  });\r\n\r\n  // Redirect if already authenticated AND user data is loaded\r\n  useEffect(() => {\r\n    if (isAuthenticated && user) {\r\n      navigate('/', { replace: true });\r\n    }\r\n  }, [isAuthenticated, user, navigate]);\r\n\r\n  // Clear error on unmount\r\n\r\n  // Initialize Google Sign-In\r\n  const initGoogle = useCallback(() => {\r\n    if (\r\n      googleInitialized.current ||\r\n      !window.google?.accounts?.id ||\r\n      !googleButtonRef.current\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    googleInitialized.current = true;\r\n\r\n    window.google.accounts.id.initialize({\r\n      client_id: import.meta.env.VITE_GOOGLE_CLIENT_ID,\r\n      callback: async response => {\r\n        if (response.credential) {\r\n          const result = await dispatch(googleAuth(response.credential));\r\n          if (googleAuth.fulfilled.match(result)) {\r\n            toast.success('Đăng nhập Google thành công!');\r\n          } else {\r\n            toast.error('Đăng nhập Google thất bại');\r\n          }\r\n        }\r\n      },\r\n    });\r\n\r\n    window.google.accounts.id.renderButton(googleButtonRef.current, {\r\n      theme: 'outline',\r\n      size: 'large',\r\n      width: 320,\r\n      text: 'continue_with',\r\n      shape: 'pill',\r\n    });\r\n  }, [dispatch]);\r\n\r\n  // Setup Google button when ref is available\r\n  useEffect(() => {\r\n    if (!googleButtonRef.current) return;\r\n\r\n    // Try immediately\r\n    initGoogle();\r\n\r\n    // If not available, poll for it\r\n    if (!googleInitialized.current) {\r\n      const interval = setInterval(() => {\r\n        if (window.google?.accounts?.id) {\r\n          initGoogle();\r\n          clearInterval(interval);\r\n        }\r\n      }, 200);\r\n\r\n      const timeout = setTimeout(() => clearInterval(interval), 10000);\r\n      return () => {\r\n        clearInterval(interval);\r\n        clearTimeout(timeout);\r\n      };\r\n    }\r\n  }, [initGoogle]);\r\n\r\n  const handleChange = e => {\r\n    setFormData({ ...formData, [e.target.name]: e.target.value });\r\n  };\r\n\r\n  const handleSubmit = async e => {\r\n    e.preventDefault();\r\n    if (!formData.email || !formData.password) {\r\n      toast.error('Vui lòng điền đầy đủ thông tin');\r\n      return;\r\n    }\r\n    const result = await dispatch(login(formData));\r\n    if (login.fulfilled.match(result)) {\r\n      toast.success('Đăng nhập thành công!');\r\n    }\r\n  };\r\n\r\n  // No longer needed due to useEffect redirect above\r\n  // if (isAuthenticated && user) {\r\n  //   return <Navigate to=\"/\" replace />;\r\n  // }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex\">\r\n      {/* Left Panel - Branding */}\r\n      <div className=\"hidden lg:flex w-1/2 bg-black items-center justify-center relative overflow-hidden\">\r\n        <div className=\"absolute inset-0 bg-gradient-to-br from-black via-neutral-900 to-black\" />\r\n\r\n        {/* Decorative circles */}\r\n        <div className=\"absolute top-20 left-20 w-64 h-64 bg-white/5 rounded-full blur-3xl\" />\r\n        <div className=\"absolute bottom-20 right-20 w-96 h-96 bg-white/3 rounded-full blur-3xl\" />\r\n\r\n        <div className=\"relative z-10 text-center px-12\">\r\n          <div className=\"w-16 h-16 rounded-full bg-white flex items-center justify-center mx-auto mb-8\">\r\n            <Sparkles size={28} className=\"text-black\" />\r\n          </div>\r\n          <h1 className=\"text-5xl font-bold text-white mb-4 tracking-tight\">\r\n            YiBu\r\n          </h1>\r\n          <p className=\"text-white/60 text-lg max-w-sm mx-auto\">\r\n            Connect, share, and discover. Your social experience reimagined.\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Right Panel - Form */}\r\n      <div className=\"w-full lg:w-1/2 flex items-center justify-center p-8 bg-white dark:bg-black\">\r\n        <div className=\"w-full max-w-md\">\r\n          {/* Mobile Logo */}\r\n          <div className=\"lg:hidden flex items-center justify-center mb-10\">\r\n            <div className=\"w-12 h-12 rounded-full bg-black dark:bg-white flex items-center justify-center\">\r\n              <Sparkles size={22} className=\"text-white dark:text-black\" />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"mb-10\">\r\n            <h2 className=\"text-3xl font-bold text-content dark:text-white mb-2\">\r\n              Welcome back\r\n            </h2>\r\n            <p className=\"text-neutral-500\">Sign in to continue to YiBu</p>\r\n          </div>\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            {/* Email */}\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-medium text-content dark:text-white\">\r\n                Email\r\n              </label>\r\n              <div className=\"relative\">\r\n                <Mail\r\n                  size={18}\r\n                  className=\"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-400\"\r\n                />\r\n                <input\r\n                  type=\"email\"\r\n                  name=\"email\"\r\n                  value={formData.email}\r\n                  onChange={handleChange}\r\n                  placeholder=\"name@example.com\"\r\n                  className=\"w-full pl-12 pr-4 py-3.5 bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl text-content dark:text-white placeholder:text-neutral-400 focus:outline-none focus:border-primary transition-colors\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Password */}\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <label className=\"text-sm font-medium text-content dark:text-white\">\r\n                  Password\r\n                </label>\r\n                <Link\r\n                  to=\"/auth/forgot-password\"\r\n                  className=\"text-sm text-neutral-500 hover:text-black dark:hover:text-white transition-colors\"\r\n                >\r\n                  Forgot?\r\n                </Link>\r\n              </div>\r\n              <div className=\"relative\">\r\n                <Lock\r\n                  size={18}\r\n                  className=\"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-400\"\r\n                />\r\n                <input\r\n                  type={showPassword ? 'text' : 'password'}\r\n                  name=\"password\"\r\n                  value={formData.password}\r\n                  onChange={handleChange}\r\n                  placeholder=\"Enter your password\"\r\n                  className=\"w-full pl-12 pr-12 py-3.5 bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl text-content dark:text-white placeholder:text-neutral-400 focus:outline-none focus:border-primary transition-colors\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowPassword(!showPassword)}\r\n                  className=\"absolute right-4 top-1/2 -translate-y-1/2 text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300\"\r\n                >\r\n                  {showPassword ? <EyeOff size={18} /> : <Eye size={18} />}\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Error Message */}\r\n            {error && (\r\n              <div className=\"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl text-red-600 dark:text-red-400 text-sm\">\r\n                <AlertCircle size={16} />\r\n                {error}\r\n              </div>\r\n            )}\r\n\r\n            {/* Submit */}\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"w-full py-3.5 bg-primary text-primary-foreground font-medium rounded-xl hover:opacity-90 transition-opacity disabled:opacity-50 flex items-center justify-center gap-2\"\r\n            >\r\n              {loading ? (\r\n                <div className=\"w-5 h-5 border-2 border-primary-foreground/30 border-t-primary-foreground rounded-full animate-spin\" />\r\n              ) : (\r\n                'Sign In'\r\n              )}\r\n            </button>\r\n\r\n            {/* Divider */}\r\n            <div className=\"relative flex items-center my-8\">\r\n              <div className=\"flex-1 border-t border-neutral-200 dark:border-neutral-800\" />\r\n              <span className=\"px-4 text-sm text-neutral-400\">or</span>\r\n              <div className=\"flex-1 border-t border-neutral-200 dark:border-neutral-800\" />\r\n            </div>\r\n\r\n            {/* Google Sign-In Button */}\r\n            <div className=\"flex justify-center\">\r\n              <div ref={googleButtonRef} />\r\n            </div>\r\n          </form>\r\n\r\n          {/* Footer */}\r\n          <p className=\"mt-10 text-center text-neutral-500\">\r\n            Don't have an account?{' '}\r\n            <Link\r\n              to=\"/auth/register\"\r\n              className=\"font-medium text-primary hover:underline\"\r\n            >\r\n              Sign up\r\n            </Link>\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\AuthPage\\ProtectedRoute.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\AuthPage\\Register.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\AuthPage\\ResetPassword.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\ErrorPages\\AccessDenied.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\NotFound\\NotFound.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\UserPage\\Explore.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\UserPage\\HashtagPosts.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\UserPage\\Home.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\UserPage\\Message.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'conversations' logical expression could make the dependencies of useEffect Hook (at line 92) change on every render. To fix this, wrap the initialization of 'conversations' in its own useMemo() Hook.","line":21,"column":9,"nodeType":"VariableDeclarator","endLine":22,"endColumn":64},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'conversations' logical expression could make the dependencies of useMemo Hook (at line 113) change on every render. To fix this, wrap the initialization of 'conversations' in its own useMemo() Hook.","line":21,"column":9,"nodeType":"VariableDeclarator","endLine":22,"endColumn":64}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from 'react';\r\nimport { useNavigate, Outlet, useParams } from 'react-router-dom';\r\nimport { useSelector } from 'react-redux';\r\nimport { Search, Settings, MessageCircle, Loader2, Users } from 'lucide-react';\r\nimport {\r\n  useConversations,\r\n  useCreateConversation,\r\n  useCreateGroup,\r\n} from '@/hooks/useMessageQuery';\r\nimport { useSearchUsers } from '@/hooks/useSearchQuery';\r\nimport ConversationItem from '@/components/features/chat/ConversationItem';\r\nimport CreateGroupModal from '@/components/features/chat/CreateGroupModal';\r\nimport { useDebounce } from '@/hooks/useDebounce';\r\n\r\nfunction Message() {\r\n  const navigate = useNavigate();\r\n  const { conversationId } = useParams();\r\n\r\n  const { data: conversationsData, isLoading: conversationsLoading } =\r\n    useConversations();\r\n  const conversations =\r\n    conversationsData?.conversations || conversationsData || [];\r\n\r\n  const { user } = useSelector(state => state.auth);\r\n\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [showGroupModal, setShowGroupModal] = useState(false);\r\n  const [groupName, setGroupName] = useState('');\r\n  const [userSearchTerm, setUserSearchTerm] = useState('');\r\n  const [selectedUsers, setSelectedUsers] = useState([]);\r\n  const debouncedUserSearch = useDebounce(userSearchTerm, 500);\r\n\r\n  const createConversationMutation = useCreateConversation();\r\n  const createGroupMutation = useCreateGroup();\r\n\r\n  const { data: searchResultsData, isLoading: isSearchingUsers } =\r\n    useSearchUsers({\r\n      query: debouncedUserSearch,\r\n      page: 1,\r\n      limit: 5,\r\n    });\r\n  const searchResults = searchResultsData?.users || searchResultsData || [];\r\n\r\n  // Handle Deep Linking / Sync Route\r\n  useEffect(() => {\r\n    const handleSync = async () => {\r\n      if (!conversationId || conversationId === 'messages') return;\r\n\r\n      const existing = conversations.find(\r\n        c =>\r\n          c._id === conversationId ||\r\n          c.conversationId === conversationId ||\r\n          c.id === conversationId ||\r\n          c.directId === conversationId\r\n      );\r\n\r\n      if (\r\n        existing &&\r\n        conversationId.includes('_') &&\r\n        existing._id &&\r\n        existing._id !== conversationId\r\n      ) {\r\n        navigate(`/messages/${existing._id}`, { replace: true });\r\n        return;\r\n      }\r\n\r\n      if (!existing && !conversationsLoading) {\r\n        // Match user1Id_user2Id format\r\n        const pairMatch = conversationId.match(\r\n          /^([a-f\\d]{24})_([a-f\\d]{24})$/i\r\n        );\r\n        if (pairMatch) {\r\n          const [_, u1, u2] = pairMatch;\r\n          const targetId = u1 === user?._id ? u2 : u1;\r\n          if (targetId) {\r\n            try {\r\n              const conv = await createConversationMutation.mutateAsync(\r\n                targetId\r\n              );\r\n              if (conv?._id && conv?._id !== conversationId) {\r\n                navigate(`/messages/${conv._id}`, { replace: true });\r\n              }\r\n            } catch (err) {\r\n              console.error('Failed to create/fetch conversation by pair', err);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    if (user) handleSync();\r\n  }, [\r\n    conversationId,\r\n    conversations,\r\n    user,\r\n    conversationsLoading,\r\n    navigate,\r\n    createConversationMutation,\r\n  ]);\r\n\r\n  const filteredConversations = useMemo(() => {\r\n    if (!Array.isArray(conversations)) return [];\r\n    return conversations.filter(c => {\r\n      const otherUser =\r\n        c.otherUser ||\r\n        c.participant ||\r\n        c.members?.find(m => m._id !== user?._id);\r\n      const name = c.isGroup\r\n        ? c.name || 'Nhóm'\r\n        : otherUser?.name || otherUser?.fullName || otherUser?.username || '';\r\n      return name.toLowerCase().includes(searchQuery.toLowerCase());\r\n    });\r\n  }, [conversations, searchQuery, user?._id]);\r\n\r\n  const handleCreateGroup = async () => {\r\n    if (!groupName.trim() || selectedUsers.length < 2) return;\r\n    try {\r\n      const newGroup = await createGroupMutation.mutateAsync({\r\n        name: groupName,\r\n        participantIds: selectedUsers.map(u => u._id),\r\n      });\r\n\r\n      setShowGroupModal(false);\r\n      setGroupName('');\r\n      setSelectedUsers([]);\r\n      navigate(`/messages/${newGroup._id || newGroup.id}`);\r\n    } catch (error) {\r\n      console.error('Failed to create group:', error);\r\n    }\r\n  };\r\n\r\n  const toggleUserSelection = user => {\r\n    if (selectedUsers.find(u => u._id === user._id)) {\r\n      setSelectedUsers(selectedUsers.filter(u => u._id !== user._id));\r\n    } else {\r\n      setSelectedUsers([...selectedUsers, user]);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex w-full h-[calc(100vh-4rem)] md:h-screen bg-transparent overflow-hidden\">\r\n      {/* Left Sidebar (Conversation List) */}\r\n      <div\r\n        className={`w-full md:w-[380px] lg:w-[400px] flex-shrink-0 border-r border-border flex flex-col bg-background transition-all ${\r\n          conversationId ? 'hidden md:flex' : 'flex'\r\n        }`}\r\n      >\r\n        {/* Header */}\r\n        <div className=\"p-5 border-b border-border\">\r\n          <div className=\"flex items-center justify-between mb-6\">\r\n            <h1 className=\"text-2xl font-black text-content tracking-tight\">\r\n              Tin nhắn\r\n            </h1>\r\n            <div className=\"flex items-center gap-1\">\r\n              <button\r\n                onClick={() => setShowGroupModal(true)}\r\n                className=\"yb-btn-ghost p-2.5 rounded-full transition-all text-secondary hover:text-primary\"\r\n                title=\"Tạo nhóm chat\"\r\n              >\r\n                <Users size={22} />\r\n              </button>\r\n              <button className=\"yb-btn-ghost p-2.5 rounded-full transition-all text-secondary hover:text-primary\">\r\n                <Settings size={22} />\r\n              </button>\r\n            </div>\r\n          </div>\r\n          {/* Search */}\r\n          <div className=\"relative group\">\r\n            <Search\r\n              size={18}\r\n              className=\"absolute left-4 top-1/2 -translate-y-1/2 text-text-tertiary group-focus-within:text-primary transition-colors\"\r\n            />\r\n            <input\r\n              type=\"text\"\r\n              value={searchQuery}\r\n              onChange={e => setSearchQuery(e.target.value)}\r\n              placeholder=\"Tìm kiếm cuộc trò chuyện...\"\r\n              className=\"w-full pl-11 pr-4 py-3 rounded-2xl bg-surface-secondary text-content border border-transparent focus:border-border-focus placeholder:text-text-tertiary text-sm focus:outline-none transition-all duration-300\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Conversations List */}\r\n        <div className=\"flex-1 overflow-y-auto custom-scrollbar pb-20 md:pb-0\">\r\n          {conversationsLoading && conversations.length === 0 ? (\r\n            <div className=\"flex flex-col items-center justify-center py-12 space-y-4\">\r\n              <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n              <p className=\"text-xs text-text-tertiary font-medium\">\r\n                Đang tải cuộc trò chuyện...\r\n              </p>\r\n            </div>\r\n          ) : filteredConversations.length === 0 ? (\r\n            <div className=\"p-10 text-center flex flex-col items-center justify-center space-y-4\">\r\n              <div className=\"w-16 h-16 bg-surface-secondary rounded-3xl flex items-center justify-center border border-border\">\r\n                <MessageCircle size={32} className=\"text-text-tertiary\" />\r\n              </div>\r\n              <p className=\"text-text-tertiary text-sm font-medium\">\r\n                {searchQuery\r\n                  ? 'Không tìm thấy kết quả'\r\n                  : 'Chưa có cuộc trò chuyện nào'}\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"\">\r\n              {filteredConversations.map(conversation => {\r\n                const id =\r\n                  conversation._id ||\r\n                  conversation.conversationId ||\r\n                  conversation.id;\r\n                return (\r\n                  <ConversationItem\r\n                    key={id}\r\n                    conversation={conversation}\r\n                    isActive={\r\n                      !!conversationId &&\r\n                      (conversationId === id ||\r\n                        conversation.directId === conversationId)\r\n                    }\r\n                    onClick={() => navigate(`/messages/${id}`)}\r\n                    currentUserId={user?._id}\r\n                  />\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Right Content Area (Rendered via Outlet) */}\r\n      <div\r\n        className={`flex-1 min-w-0 bg-background flex flex-col ${\r\n          conversationId ? 'flex' : 'hidden md:flex'\r\n        }`}\r\n      >\r\n        <Outlet />\r\n      </div>\r\n\r\n      {/* Create Group Modal */}\r\n      <CreateGroupModal\r\n        isOpen={showGroupModal}\r\n        onClose={() => setShowGroupModal(false)}\r\n        groupName={groupName}\r\n        setGroupName={setGroupName}\r\n        searchQuery={userSearchTerm}\r\n        onSearchChange={setUserSearchTerm}\r\n        searchResults={searchResults}\r\n        selectedUsers={selectedUsers}\r\n        onToggleUser={toggleUserSelection}\r\n        isSearching={isSearchingUsers}\r\n        onSubmit={handleCreateGroup}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Message;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\UserPage\\Notifications.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\pages\\UserPage\\UserLayout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\redux\\actions\\authActions.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\redux\\slices\\AuthSlice.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'action' is defined but never used.","line":138,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":138,"endColumn":51,"suggestions":[{"messageId":"removeVar","data":{"varName":"action"},"fix":{"range":[4016,4024],"text":""},"desc":"Remove unused variable 'action'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createSlice } from '@reduxjs/toolkit';\r\nimport {\r\n  login,\r\n  register,\r\n  googleAuth,\r\n  logout,\r\n  logoutAll,\r\n  updatePassword,\r\n  requestPasswordReset,\r\n  resetPassword,\r\n  enable2FA,\r\n  verify2FA,\r\n  disable2FA,\r\n  getSessions,\r\n  revokeSession,\r\n} from '@/redux/actions/authActions';\r\n\r\nconst initialState = {\r\n  user: null,\r\n  isAuthenticated: false,\r\n  loading: false,\r\n  error: null,\r\n  sessions: [],\r\n  twoFactorEnabled: false,\r\n  twoFactorPending: false,\r\n};\r\n\r\nconst authSlice = createSlice({\r\n  name: 'auth',\r\n  initialState,\r\n  reducers: {\r\n    clearError: state => {\r\n      state.error = null;\r\n    },\r\n    setUser: (state, action) => {\r\n      state.user = action.payload;\r\n      state.isAuthenticated = !!action.payload;\r\n    },\r\n    setIsAuthenticated: (state, action) => {\r\n      state.isAuthenticated = action.payload;\r\n    },\r\n    updateUserProfile: (state, action) => {\r\n      if (state.user) {\r\n        state.user = { ...state.user, ...action.payload };\r\n      }\r\n    },\r\n    resetAuthState: () => initialState,\r\n  },\r\n  extraReducers: builder => {\r\n    builder\r\n      // Login\r\n      .addCase(login.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(login.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        state.user = action.payload;\r\n        state.isAuthenticated = true;\r\n        state.twoFactorEnabled = action.payload?.twoFactorEnabled || false;\r\n      })\r\n      .addCase(login.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      // Register\r\n      .addCase(register.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(register.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        state.user = action.payload;\r\n        state.isAuthenticated = true;\r\n      })\r\n      .addCase(register.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      // Google Auth\r\n      .addCase(googleAuth.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(googleAuth.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        state.user = action.payload;\r\n        state.isAuthenticated = true;\r\n      })\r\n      .addCase(googleAuth.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      // Logout\r\n      .addCase(logout.fulfilled, () => initialState)\r\n      .addCase(logout.rejected, () => initialState)\r\n      .addCase(logoutAll.fulfilled, () => initialState)\r\n      // Update Password\r\n      .addCase(updatePassword.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(updatePassword.fulfilled, state => {\r\n        state.loading = false;\r\n      })\r\n      .addCase(updatePassword.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      // Password Reset Request\r\n      .addCase(requestPasswordReset.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(requestPasswordReset.fulfilled, state => {\r\n        state.loading = false;\r\n      })\r\n      .addCase(requestPasswordReset.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      // Reset Password\r\n      .addCase(resetPassword.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(resetPassword.fulfilled, state => {\r\n        state.loading = false;\r\n      })\r\n      .addCase(resetPassword.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      // 2FA Enable\r\n      .addCase(enable2FA.pending, state => {\r\n        state.loading = true;\r\n      })\r\n      .addCase(enable2FA.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        state.twoFactorPending = true;\r\n      })\r\n      .addCase(enable2FA.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      // 2FA Verify\r\n      .addCase(verify2FA.pending, state => {\r\n        state.loading = true;\r\n      })\r\n      .addCase(verify2FA.fulfilled, state => {\r\n        state.loading = false;\r\n        state.twoFactorEnabled = true;\r\n        state.twoFactorPending = false;\r\n      })\r\n      .addCase(verify2FA.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      // 2FA Disable\r\n      .addCase(disable2FA.fulfilled, state => {\r\n        state.twoFactorEnabled = false;\r\n      })\r\n      // Sessions\r\n      .addCase(getSessions.fulfilled, (state, action) => {\r\n        // Handle { sessions } or direct array\r\n        state.sessions =\r\n          action.payload?.sessions ||\r\n          (Array.isArray(action.payload) ? action.payload : []);\r\n      })\r\n      .addCase(revokeSession.fulfilled, (state, action) => {\r\n        state.sessions = state.sessions.filter(\r\n          session => session.id !== action.payload.sessionId\r\n        );\r\n      });\r\n  },\r\n});\r\n\r\nexport const {\r\n  clearError,\r\n  setUser,\r\n  setIsAuthenticated,\r\n  updateUserProfile,\r\n  resetAuthState,\r\n} = authSlice.actions;\r\nexport default authSlice.reducer;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\redux\\store.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\utils\\apiUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\utils\\commentUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\utils\\dateUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\utils\\formatTime.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\utils\\interactionUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\utils\\notificationUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\utils\\numberUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\utils\\postUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\src\\utils\\reportUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\cyhin\\YiBu\\client\\vite.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]